# Exercise 20: Creating a Host with Corresponding DNS Entries

## Implementation

## 1. Extending Terraform with the SSH Known Hosts Module

In `main.tf`, the `createSshKnownHosts` module was used with the DNS name instead of the raw IP:

```tf
module "createSshKnownHosts" {
  source              = "../Modules/SshKnownHosts"
  loginUserName       = "devops"
  serverNameOrIp      = "${var.serverName}.${var.dnsZone}"
  serverHostPublicKey = tls_private_key.host.public_key_openssh
}
```

- `serverNameOrIp` now points to `workhorse.g1.sdi.hdm-stuttgart.cloud`.
- This ensures generated SSH and SCP wrapper scripts, as well as the known_hosts file, rely on the DNS hostname.

## 2. Planning and Applying Terraform

Ran the following commands:

```tf
terraform plan -var-file="secrets.tfvars"
terraform apply -var-file="secrets.tfvars"
```

**Result:**

```tf
Plan: 3 to add, 0 to change, 0 to destroy.
Apply complete! Resources: 3 added, 0 changed, 0 destroyed.
```

Generated resources:

- `gen/known_hosts`
- `bin/ssh`
- `bin/scp`

## 3. Generated Files

**gen/known_hosts**

```tf
workhorse.g1.sdi.hdm-stuttgart.cloud ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIBGurzVlZ0fp9cI6WYpuyFsrFTlpWWLJp4EU3iXj4Voy
```

**bin/ssh**

```tf
#!/bin/bash
ssh -o UserKnownHostsFile=$(dirname "$0")/../gen/known_hosts \
    devops@workhorse.g1.sdi.hdm-stuttgart.cloud "$@"
```

**bin/scp**

```tf
#!/bin/bash
scp -o UserKnownHostsFile=$(dirname "$0")/../gen/known_hosts \
    "$@" devops@workhorse.g1.sdi.hdm-stuttgart.cloud:
```

## 4. Verification

Executed:

```tf
./bin/ssh
```

**Result:**

- Successful login to the Debian host via DNS name.
- No more IP mismatch warnings.
- SSH and SCP commands now resolve cleanly using the DNS hostname.
