# Exercise 15: Partitions and Mounting

## 1. Objective

The goal of this exercise was to extend our Terraform-managed server by attaching an additional volume, then manually partitioning and mounting it inside the Linux system. Finally, the setup had to ensure that the mounts persisted across reboots.

## 2. Terraform Configuration

We extended our Terraform configuration to create a new Hetzner Cloud volume and attach it to the server provisioned in Exercise 14.

**Volume Resource**

```tf
resource "hcloud_volume" "volume01" {
  name       = "volume1"
  size       = 10
  server_id  = hcloud_server.exercise_14.id
  automount  = true
  format     = "xfs"
}
```

**Outputs**

```tf
output "volume_id" {
  value       = hcloud_volume.volume01.id
  description = "The volume's id"
}

output "volume_linux_device" {
  value       = hcloud_volume.volume01.linux_device
  description = "The volume's linux device"
}
```

After applying:

```tf
Apply complete! Resources: 1 added, 0 changed, 0 destroyed.

Outputs:
server_datacenter = "hel1-dc2"
server_ip         = "95.216.223.223"
volume_id         = "102995739"
volume_linux_device = "/dev/disk/by-id/scsi-0HC_Volume_102995739"
```

## 3. Detecting the New Volume

Initially, the new volume `/dev/sdb` was not visible. To detect it, we ran:

```tf
sudo udevadm trigger
```

Afterwards, listing block devices confirmed its presence:

```tf
lsblk
```

Output (before partitioning):

```tf
sdb    8:16   0   10G  0 disk
```

## 4. Partitioning the Volume

We used `fdisk` to create two primary partitions of ~5 GB each:

```tf
sudo fdisk /dev/sdb
```

Steps:

- `n` → create new partition
- Type: `p` → primary
- Size: +5G
- Repeated for second partition
- Saved with `w`

Resulting devices:

```tf
/dev/sdb1   5G
/dev/sdb2   5G
```

## 5. Creating File Systems

We formatted the new partitions with different file systems:

```tf
sudo mkfs -t ext4 /dev/sdb1
sudo mkfs -t xfs /dev/sdb2
```

## 6. Mounting the Partitions

We created mount points:

```tf
sudo mkdir /disk1 /disk2
```

Mounted them as follows:

```
sudo mount /dev/sdb1 /disk1
sudo mount UUID=$(sudo blkid -s UUID -o value /dev/sdb2) /disk2
```

Verification:

```tf
df -h
```

Showed `/disk1` and `/disk2` mounted successfully.

## 7. Persistent Mounts with fstab

We edited `/etc/fstab` to ensure partitions mount automatically after reboot.

Entries added:

```tf
/dev/sdb1    /disk1    ext4    defaults    0    0
UUID=<UUID-of-sdb2>    /disk2    xfs    defaults    0    0
```

Then tested with:

```tf
sudo mount -a
```

No errors occurred, confirming the syntax was valid.

## 8. Verification After Reboot

After rebooting the system, both partitions were automatically mounted.

```tf
df -h
```

Confirmed that `/disk1` (ext4) and `/disk2` (xfs) were available.

## 9. Problems Encountered

- Volume not visible at first
  → Solved with `sudo udevadm trigger`.
- fstab UUID mistake
  → Accidentally typed placeholder instead of real UUID. Corrected using `sudo blkid`.
- fstab syntax caution
  → Verified with `mount -a` before reboot to avoid boot issues.
