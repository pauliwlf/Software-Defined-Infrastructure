# Exercise 19: Creating DNS Records with Terraform

## Implementation

## 1. Variables

Defined in `variables.tf` and `config.auto.tfvars`:

```tf
serverIp      = "1.2.3.4"
dnsZone       = "g1.sdi.hdm-stuttgart.cloud"
serverName    = "workhorse"
serverAliases = ["www", "mail"]
```

Validation rules ensured:

- No duplicate aliases (`distinct` function).
- No alias equal to the canonical name (`contains` function).

## 2. Providers

- **Hetzner Cloud Provider** → for server and firewall.
- **DNS Provider (hashicorp/dns)** → with HMAC-SHA512 authentication against `ns1.hdm-stuttgart.cloud`.

## 3. Terraform Resources

**A Record for Base Domain:**

```tf
resource "dns_a_record_set" "base_record" {
  zone      = "${var.dnsZone}."
  addresses = [var.serverIp]
  ttl       = 10
}
```

**A Record for Canonical Server Name:**

```tf
resource "dns_a_record_set" "server_record" {
  zone      = "${var.dnsZone}."
  name      = var.serverName
  addresses = [var.serverIp]
  ttl       = 10
}
```

**CNAME Records for Aliases:**

```tf
resource "dns_cname_record" "alias_records" {
  for_each = toset(var.serverAliases)
  zone     = "${var.dnsZone}."
  name     = each.key
  cname    = "${var.serverName}.${var.dnsZone}."
  ttl      = 10
}
```

## Verification

Executed:

```tf
dig +noall +answer \
  @ns1.hdm-stuttgart.cloud \
  -y hmac-sha512:g1.key:<SECRET> \
  -t AXFR g1.sdi.hdm-stuttgart.cloud
```

**Output:**

```tf
g1.sdi.hdm-stuttgart.cloud.          10 IN A     157.180.35.105
workhorse.g1.sdi.hdm-stuttgart.cloud. 10 IN A    157.180.35.105
mail.g1.sdi.hdm-stuttgart.cloud.     10 IN CNAME workhorse.g1.sdi.hdm-stuttgart.cloud.
www.g1.sdi.hdm-stuttgart.cloud.      10 IN CNAME workhorse.g1.sdi.hdm-stuttgart.cloud.
```
