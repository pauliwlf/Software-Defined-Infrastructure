# Exercise 18: Enhancing Your Web Server

## Objective

The goal of this exercise was to enhance our existing web server setup by:

1. Adding DNS A records to resolve a human-readable domain to our server’s IP.
2. Configuring Nginx to serve the site under the new domain.
3. Securing the site with HTTPS using Let’s Encrypt TLS certificates.

### Steps:

## 1. DNS A Records Setup

We created two DNS entries pointing to our server’s IP (`95.216.223.223`) using `nsupdate` with the provided key:

```tf
nsupdate -k ./g1.key
> server ns1.hdm-stuttgart.cloud
> update add www.g1.sdi.hdm-stuttgart.cloud 10 A 95.216.223.223
> update add g1.sdi.hdm-stuttgart.cloud 10 A 95.216.223.223
> send
> quit
```

Verification with `dig` confirmed the DNS resolution worked:

```tf
dig +noall +answer @ns1.hdm-stuttgart.cloud g1.sdi.hdm-stuttgart.cloud
```

Result:

```tf
g1.sdi.hdm-stuttgart.cloud. 10 IN A 95.216.223.223
```

Both `g1.sdi.hdm-stuttgart.cloud` and `www.g1.sdi.hdm-stuttgart.cloud` resolved to the server IP.

## 2. Configuring Nginx for the Domain

We set up a new Nginx server block to handle requests for both domain names:

**/etc/nginx/sites-available/g1.sdi.hdm-stuttgart.cloud**

```tf
server {
    listen 80;
    listen [::]:80;

    root /var/www/g1.sdi.hdm-stuttgart.cloud/html;
    index index.html index.htm;

    server_name g1.sdi.hdm-stuttgart.cloud www.g1.sdi.hdm-stuttgart.cloud;

    location / {
        try_files $uri $uri/ =404;
    }
}
```

Then we tested the configuration and restarted Nginx:

```tf
sudo nginx -t
sudo systemctl restart nginx
```

Opening the domain in the browser showed the Nginx landing page with our custom message.

## 3. Securing with Let’s Encrypt TLS Certificates

We installed and used Certbot to request certificates for both domain variants.

First, we used a staging certificate to avoid Let’s Encrypt rate limits:

```tf
sudo certbot --nginx --test-cert -d g1.sdi.hdm-stuttgart.cloud -d www.g1.sdi.hdm-stuttgart.cloud
```

After verifying success, we requested the real certificate:

```tf
sudo certbot --nginx -d g1.sdi.hdm-stuttgart.cloud -d www.g1.sdi.hdm-stuttgart.cloud
```

Finally, we confirmed automatic renewal works:

```tf
sudo certbot renew --dry-run
```

Output confirmed that the certificates would renew successfully.

## Final Verification

- Access to both `http://g1.sdi.hdm-stuttgart.cloud` and `http://www.g1.sdi.hdm-stuttgart.cloud` worked.
- HTTPS access confirmed with a valid Let’s Encrypt certificate:
  `https://g1.sdi.hdm-stuttgart.cloud`
  `https://www.g1.sdi.hdm-stuttgart.cloud`
- Automatic certificate renewal tested successfully.

### Screenshot evidence:

- DNS update and verification with `dig`.
- Browser access via domain name.
- Certbot successful certificate deployment.
- Dry-run renewal showing success.
